# 'branch submit' supports empty templates.

as 'Test <test@example.com>'
at '2025-11-05T21:28:29Z'

# setup
cd repo
git init
git add .shamhub
git commit -m 'Initial commit'

# set up a fake remote
shamhub init
shamhub new origin alice/example.git
shamhub register alice
git push origin main

env SHAMHUB_USERNAME=alice
gs auth login

# Editor should return original input unchanged.
env EDITOR=true

git add feat1.txt
gs bc feature -m 'Add feature'

## Test 1: Prompt when no default is set

mkdir $WORK/output
env ROBOT_INPUT=$WORK/robot-with-prompt.golden ROBOT_OUTPUT=$WORK/robot-with-prompt.actual
gs branch submit
cmp $WORK/robot-with-prompt.actual $WORK/robot-with-prompt.golden

## Test 2: No prompt when default template is set

git config spice.submit.template 'empty.md'
env EDITOR=mockedit MOCKEDIT_GIVE=$WORK/input/feature2-commit-msg
gs trunk
git add feat2.txt
gs bc feature2 -m 'Add feature 2'

env ROBOT_INPUT=$WORK/robot-no-prompt.golden ROBOT_OUTPUT=$WORK/robot-no-prompt.actual
gs branch submit
cmp $WORK/robot-no-prompt.actual $WORK/robot-no-prompt.golden

-- repo/.shamhub/CHANGE_TEMPLATE/standard.md --
## Summary

Explain the changes you made.

## Testing

Explain how these changes were tested.

-- repo/.shamhub/CHANGE_TEMPLATE/empty.md --
-- repo/feat1.txt --
Feature content
-- repo/feat2.txt --
Feature 2 content
-- input/feature-commit-msg --
Add feature

This adds a feature implementation.
-- robot-with-prompt.golden --
===
> Title: Add feature 
> Short summary of the change
true
===
> Template: 
>
> â–¶ empty.md
>   standard.md
>
> Choose a template for the change body
"empty.md"
===
> Body: Press [e] to open true or [enter/tab] to skip
> Open your editor to write a detailed description of the change
{
  "want": "\n"
}
===
> Draft: [y/N]
> Mark the change as a draft?
false
-- robot-no-prompt.golden --
===
> Title: Add feature 2 
> Short summary of the change
true
===
> Body: Press [e] to open mockedit or [enter/tab] to skip
> Open your editor to write a detailed description of the change
{
  "want": "\n"
}
===
> Draft: [y/N]
> Mark the change as a draft?
false
