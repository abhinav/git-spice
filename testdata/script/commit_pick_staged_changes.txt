[!git:2.45.0] skip # feature requires git 2.45

as 'Test User <test@example.com>'
at 2025-09-01T23:40:12Z

# 'gs commit pick' refuses to run if there are any staged changes.

cd repo
git init
git commit --allow-empty -m 'Initial commit'
gs repo init
git config spice.experiment.commitPick true

# Branch to cherry pickf rom
git add source.txt
gs branch create source -m 'Add source file'

# Branch to cherry pick to
gs trunk
git add target.txt
gs branch create target -m 'Add target file'

# Stage some changes
cp $WORK/extra/modified-target.txt target.txt
git add target.txt
git status --porcelain
cmp stdout $WORK/golden/status.txt

# Cherry-pick should fail due to staged changes
! gs commit pick source
cmp stderr $WORK/golden/error.txt

# Verify cherry-pick failed - source file should not exist
! exists source.txt

# Verify staged changes are still present unchanged
git status --porcelain
cmp stdout $WORK/golden/status.txt

-- repo/source.txt --
Content from source branch
-- repo/target.txt --
Content from target branch
-- extra/modified-target.txt --
Staged changes content
-- golden/status.txt --
M  target.txt
-- golden/error.txt --
ERR Local changes would be overwritten by cherry-pick:
ERR   target.txt
FTL gs: cannot cherry-pick with staged changes
